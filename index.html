<audio id="intro" src="audio/pockemonaudio.mp3"></audio>
<audio id="walking" src="audio/walking.mp3"></audio>
<audio id="natural" src="audio/natural.mp3"></audio>
<audio id="springtown" src="audio/springtown.mp3"></audio>
<audio id="naturalnight" src="audio/naturalnight.mp3"></audio>

<canvas id="layer_bottom"></canvas>
<canvas id="layer_top"></canvas>

<script>

  // const miAudio = document.getElementById("mi-audio");
  //miAudio.play();


//Audios del juego

var intro = document.getElementById("intro")
intro.play() 



var walking = document.getElementById('walking');
var natural = document.getElementById('natural');
var springtown_audio = document.getElementById('springtown');
var naturalnight = document.getElementById('naturalnight');

//INTERACCION CON EL PERSONAJE
var globalvar = 1;
var startofplaceX;
var startofplaceY;
var direccion = 1;

  //INICIALIZACION DE CAPAS
  var layer_bottom = document.getElementById("layer_bottom");
  var lb_map = layer_bottom.getContext("2d");

  var layer_top = document.getElementById("layer_top");
  var lt_map = layer_top.getContext("2d");

  layer_bottom.setAttribute("style", "z-index: 2; position:absolute;");
  layer_bottom.width = 800;
  layer_bottom.height = 600;

  layer_top.setAttribute("style", "z-index: 10000; position:relative;");
  layer_top.width = 800;
  layer_top.height = 600;

  //INICIALIZACION DE LAYER BOTTOM 
  var imagen = new Image();
  imagen.src = "img/pockemon.png";

  imagen.onload = function () {
    lb_map.drawImage(imagen, 180, 10, 450, 180);
  }  

  //INICIALIZACION DE LAYER TOP 
  var font = new FontFace('pokemon', 'url(fonts/PokemonHollow.ttf)');
    font.load().then(function (loadedFont) {
    document.fonts.add(loadedFont);
    
    startofplaceX = 650;
    startofplaceY = 280;

    lb_map.font = '30px pokemon';
    lb_map.fillText('1.- J U E G O    N U E V O', 180, 500);
    lb_map.fillText('2 -  S A L I R', 180, 550);
  }); 

  //DIFINCION DE ELEMENTOS DINAMICOS
  var myImage = new Image();
  myImage.src = "img/player/left2.png";   
  myImage.onload = function () {
                //this.x = startofplaceX;
                //this.y = startofplaceY;
                lt_map.drawImage(myImage, startofplaceX, startofplaceY, 50, 50);                
                lt_map.font = 'bold 20px arial';
                lt_map.fillText(this.name, this.x , this.y);
            }

const city = ({name = 'Principal', x = null, y = null, width = null, height = null, routeImage = null}) => ({

name,
x,
y,
width,
height,
routeImage,

          draw () {

                var myImage = new Image();
                myImage.src = routeImage;   
                myImage.onload = function () {

                    lb_map.drawImage(myImage, width, height, 800, 600);

                } 

              }

})

const player = ({name = 'player', x = 0, y = 0, width = 130, height = 100, routeImage = null, speed = 5, location = 1}) => ({

name,
x,
y,
width,
height,
location,
speed: 5,
routeImage,
            draw () {
 //var myImage = new Image();
 // myImage.src = routeImage;  
           // myImage.onload = function () {
                //this.x = startofplaceX;
                //this.y = startofplaceY;
                var pasosX = ((x / 2) % 2);
                var pasosY = ((y / 2) % 2);
                
                switch(direccion){

                  case 1:  
                        if(pasosX == 0){
                        myImage.src = "img/player/left1.png";
                      } else {
                        myImage.src = "img/player/left2.png";
                      }

                      break;

                      case 2:  
                        if(pasosY == 0){
                        myImage.src = "img/player/up1.png";
                      } else {
                        myImage.src = "img/player/up2.png";
                      }
                      
                      break;

                      case 3:  
                        if(pasosX == 0){
                        myImage.src = "img/player/right1.png";
                      } else {
                        myImage.src = "img/player/right2.png";
                      }
                      
                      break;

                      case 4:  
                        if(pasosY == 0){
                        myImage.src = "img/player/down1.png";
                      } else {
                        myImage.src = "img/player/down2.png";
                      }
                      
                      break;


                }

                lt_map.clearRect(0, 0, layer_bottom.width, layer_bottom.height)
                lt_map.drawImage(myImage, x, y, 50, 50);                
                lt_map.font = 'bold 20px arial';
                lt_map.fillText(this.name, this.x , this.y);
                console.log("COORDENADA X (" + firstplayer.x + ") Y (" + firstplayer.y + ")");
           // } 
          }
})

const nps = ({name = 'hola', x = 0, y = 0,  npsrouteImage = null, speed = 5}) => ({

name,
x,
y,
location,
speed: 5,
npsrouteImage,
            draw () {
  var npsmyImage = new Image();
  npsmyImage.src = npsrouteImage;  
  npsmyImage.onload = function () {
                //this.x = startofplaceX;
                //this.y = startofplaceY;
                
                

                lb_map.drawImage(npsmyImage, x, y, 50, 50);                
                lb_map.font = 'bold 20px';
                lb_map.fillText("Hoenn", 160 , 320);
            } 
          }
})

//En este espacio vamos a crear las casas

const my_house = city({

  name            : 'myHouse',
  with            : 0,
  height          : 0,
  routeImage      : "img/house/myhouse.png"
});

const houseTeacher = city({

  name            : 'teacherHouse',
  with            : 0,
  height          : 0,
  routeImage      : "img/house/house_teacher.png",

});

//En este apartados vamos a crear los mundos
const springTown = city({

  name            : 'SpringTown',
  width           : 0,
  height          : 0,
  routeImage      : "img/puebloprimavera.png"

});

const pallettown = city({

  name            : 'pallettown',
  width           : 0,
  height          : 0,
  routeImage      : "img/pallettown.png"

});

const shadowVille = city({

  name            : 'shadowville',
  with            : 0,
  height          : 0,
  routeImage      : "img/shadowville.png",

})

//Aqui se va a definir los objetos de los jugadores.
var firstplayer;

function mover(x, y, w) {

firstplayer = player({

  name            :    "Carlos",
  x               :     x,
  y               :     y,
  routeImage      :    "img/player.png",
  speed           :    5,
  location        :    w

});
firstplayer.draw();

}


//Aqui se va a definir los nps

var mother;

function mothernps(x, y, w) {

mother = nps({

  name            :    "Hoenn",
  x               :     x,
  y               :     y,
  npsrouteImage   :    "img/nps/motherleft.png",
  speed           :    5,
  location        :    w

});
mother.draw();

}


//Aqui estan las funciones que nos permitira mostrar el mundo de forma dinamica
//Esta limpia pantalla y carga el mapa

function springTown_views(){

      globalvar = 1;
      startofplaceX = 120;
      startofplaceY = 270;
      lb_map.clearRect(0, 0, layer_bottom.width, layer_bottom.height);
      lt_map.clearRect(0, 0, layer_top.width, layer_top.height);
      springTown.draw();
      natural.pause();
      springtown_audio.play()
      mover(startofplaceX, startofplaceY, globalvar);
  
}

function palletTown_views(){

      lt_map.clearRect(0, 0, layer_bottom.width, layer_bottom.height);
      globalvar = 2;
      startofplaceX = 750;
      startofplaceY = 170;
      lb_map.clearRect(0, 0, layer_bottom.width, layer_bottom.height);
      lt_map.clearRect(0, 0, layer_top.width, layer_top.height);
      pallettown.draw();
      springtown_audio.pause()
      naturalnight.pause()
      natural.play()
      mover(startofplaceX, startofplaceY, globalvar);

}

function shadowVille_views(){

      lt_map.clearRect(0, 0, layer_bottom.width, layer_bottom.height);
      globalvar = 3;
      startofplaceX = 740;
      startofplaceY = 310;
      lb_map.clearRect(0, 0, layer_bottom.width, layer_bottom.height);
      lt_map.clearRect(0, 0, layer_top.width, layer_top.height);
      shadowVille.draw()
      natural.pause()
      springtown_audio.pause()
      naturalnight.play()
      mover(startofplaceX, startofplaceY, globalvar);
      

}

function house1_Views(){

      globalvar = 10;
      lb_map.clearRect(0, 0, layer_bottom.width, layer_bottom.height);
      lt_map.clearRect(0, 0, layer_top.width, layer_top.height);
      my_house.draw()
      mothernps(160,320,11)
      mover(startofplaceX, startofplaceY, globalvar);

}

function houseTeacher_views(){
      
      globalvar = 11;
      lt_map.clearRect(0, 0, layer_bottom.width, layer_bottom.height);
      lt_map.clearRect(0, 0, layer_top.width, layer_top.height);
      houseTeacher.draw();
      mover(startofplaceX, startofplaceY, globalvar);

}



//INTERACCION CON MENU
layer_top.addEventListener("click", function(event) {
  var x = event.clientX - layer_top.offsetLeft;
  var y = event.clientY - layer_top.offsetTop;
  

  if (x >= 55 && x <= 489 && y >= 470 && y <= 504) {
    lb_map.clearRect(0, 0, layer_bottom.width, layer_bottom.height)

    springTown.draw();
    intro.pause();
    springtown_audio.play()


    mover(650, 280, 1);
  }
});



window.addEventListener("keydown", (event) => {
    //CAPTURA DE COORDENADAS
    switch(event.key){
      case 'ArrowUp':
        direccion = 2;

          if(startofplaceY > 0){
            
            startofplaceY -= 10; // Mover hacia arriba
            
            //umbrales
            if (globalvar === 1 && startofplaceX < 210 && startofplaceY < 220) {startofplaceY += 10;}
            
            walking.play()

            }

            break;

      case 'ArrowDown':
          direccion = 4;
              if(startofplaceY < 550){
                
                startofplaceY += 10; // Mover hacia abajo
                walking.play()
              
                } 
            break;

      case 'ArrowLeft':
          direccion = 1;

              if(startofplaceX > 0){

                startofplaceX -= 10; // Mover hacia la izquierda
                walking.play()

                }

        break;

        
      case 'ArrowRight':
          direccion = 3;

              if(startofplaceX < 760){

                startofplaceX += 10; // Mover hacia la derecha
                walking.play()
              
              }
        break;

      default:

        break;

  }
     

     mover(startofplaceX, startofplaceY, globalvar);
    //lt_map.clearRect(0, 0, layer_bottom.width, layer_bottom.height);

    if (globalvar === 1){

              if (startofplaceX === 0){

                changeworld = confirm("¿Estas seguro que quieres comenzar la aventura?")
                    if(changeworld){
                      
                      palletTown_views()
                      //lb_map.reset();
                    // lt_map.reset();
                    }
              }

              if (startofplaceX > 430 && startofplaceX < 470 && startofplaceY > 420 && startofplaceY < 450){

                  changeworld = confirm("¿Deseas entrar a casa?")
                    if(changeworld){
                      house1_Views()

                    }
              }

              if (startofplaceX > 250 && startofplaceX < 300 && startofplaceY > 140 && startofplaceY < 190){
                  
                  changeworld = confirm("Presione aceptar para entrar al laboratorio del profesor OAK")
                    if(changeworld){
                      houseTeacher_views()

                    }
              }
        }

    if (globalvar === 2) {
      
              if (startofplaceX === 760){

                  changeworld = confirm("¿Deseas regresar a Ciudad Paleta?")
                      if(changeworld){

                        springTown_views()

                      }
              }

              if(startofplaceX === 0 && startofplaceY > 90 && startofplaceX < 150){

                  changeworld = confirm("Deseas ir a Villa sombra")
                    if(changeworld){

                       shadowVille_views();

                      }
              }
        }

    if(globalvar === 3){

              if(startofplaceX === 760 && startofplaceY > 290 && startofplaceY < 320){
                  
                  changeworld = confirm("¿Deseas regresar a aldea paleta?")
                    if(changeworld){
                          
                      palletTown_views()

                    }
              }

      }

    if (globalvar === 10){

              if (startofplaceX > 330 && startofplaceX < 410 && startofplaceY > 540){

                changeworld = confirm("¿Estas seguro que deseas salir de casa?")
                  if(changeworld){

                    springTown_views()
                    
                    }
              }
        }

    if (globalvar === 11){

              if (startofplaceY > 520 && startofplaceY < 550 && startofplaceX > 190 && startofplaceX < 240){

                  changeworld = confirm("¿Desea salir del laboratorio?")
                    if(changeworld){

                      springTown_views()

                    }
              }
        }

    
    


  });
 
</script>
<link rel="stylesheet" href="style.css">