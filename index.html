<audio id="intro" src="audio/pockemonaudio.mp3"></audio>
<audio id="walking" src="audio/walking.mp3"></audio>
<audio id="natural" src="audio/natural.mp3"></audio>

<canvas id="layer_bottom"></canvas>
<canvas id="layer_top"></canvas>

<script>

  // const miAudio = document.getElementById("mi-audio");
  //miAudio.play();


//Audios del juego

//var intro = document.getElementById("intro")
//intro.play()

var walking = document.getElementById('walking')
var natural = document.getElementById('natural')

//INTERACCION CON EL PERSONAJE
var globalvar = 1;
var startofplaceX;
var startofplaceY;

  //INICIALIZACION DE CAPAS
  var layer_bottom = document.getElementById("layer_bottom");
  var lb_map = layer_bottom.getContext("2d");

  var layer_top = document.getElementById("layer_top");
  var lt_map = layer_top.getContext("2d");

  layer_bottom.setAttribute("style", "z-index: 2; position:absolute;");
  layer_bottom.width = 800;
  layer_bottom.height = 600;

  layer_top.setAttribute("style", "z-index: 10000; position:relative;");
  layer_top.width = 800;
  layer_top.height = 600;

  //INICIALIZACION DE LAYER BOTTOM 
  var imagen = new Image();
  imagen.src = "img/pockemon.png";

  imagen.onload = function () {
    lb_map.drawImage(imagen, 180, 10, 450, 180);
  }  

  //INICIALIZACION DE LAYER TOP 
  var font = new FontFace('pokemon', 'url(fonts/PokemonHollow.ttf)');
    font.load().then(function (loadedFont) {
    document.fonts.add(loadedFont);
    
    startofplaceX = 650;
    startofplaceY = 280;

    lb_map.font = '30px pokemon';
    lb_map.fillText('1.- J U E G O    N U E V O', 180, 500);
    lb_map.fillText('2 -  S A L I R', 180, 550);
  }); 

  //DIFINCION DE ELEMENTOS DINAMICOS
  var myImage = new Image();
  myImage.src = "img/player.png";   
  myImage.onload = function () {
                //this.x = startofplaceX;
                //this.y = startofplaceY;
                lt_map.drawImage(myImage, startofplaceX, startofplaceY, 50, 50);                
                lt_map.font = 'bold 20px arial';
                lt_map.fillText(this.name, this.x , this.y);
            }

const city = ({name = 'Principal', x = null, y = null, width = null, height = null, routeImage = null}) => ({

name,
x,
y,
width,
height,
routeImage,

          draw () {

                 var myImage = new Image();
                myImage.src = routeImage;   
                myImage.onload = function () {

                    lb_map.drawImage(myImage, width, height, 800, 600);

                } 

              }

})

const player = ({name = 'player', x = 0, y = 0, width = 130, height = 100, routeImage = null, speed = 5, location = 1}) => ({

name,
x,
y,
width,
height,
location,
speed: 5,
routeImage,
            draw () {
 //var myImage = new Image();
 // myImage.src = routeImage;  
           // myImage.onload = function () {
                //this.x = startofplaceX;
                //this.y = startofplaceY;
                lt_map.clearRect(0, 0, layer_bottom.width, layer_bottom.height)
                lt_map.drawImage(myImage, x, y, 50, 50);                
                lt_map.font = 'bold 20px arial';
                lt_map.fillText(this.name, this.x , this.y);
                console.log("COORDENADA X (" + firstplayer.x + ") Y (" + firstplayer.y + ")");
           // } 
          }
})

const springTown = city({
        name: 'SpringTown',
        width: 0,
        height: 0,
        routeImage : "img/puebloprimavera.png"

        });

const pallettown = city({
        name: 'pallettown',
        width: 0,
        height: 0,
        routeImage : "img/pallettown.png"

        });


  var firstplayer;
function mover(x, y, w) {
   firstplayer = player({

name        :    "Carlos",
x           :     x,
y           :     y,
routeImage  :    "img/player.png",
speed       :    5,
location    :    w
});
firstplayer.draw();

}

//INTERACCION CON MENU
layer_top.addEventListener("click", function(event) {
  var x = event.clientX - layer_top.offsetLeft;
  var y = event.clientY - layer_top.offsetTop;

  if (x >= 55 && x <= 489 && y >= 470 && y <= 504) {
    lb_map.clearRect(0, 0, layer_bottom.width, layer_bottom.height)

    springTown.draw();

    mover(650, 280, 1);
  }
});



window.addEventListener("keydown", (event) => {
    //CAPTURA DE COORDENADAS
    switch(event.key){
      case 'ArrowUp':

          if(startofplaceY > 0){

            startofplaceY -= 10; // Mover hacia arriba
            walking.play()

            }

            break;

      case 'ArrowDown':
    
              if(startofplaceY < 550){
                
                startofplaceY += 10; // Mover hacia abajo
                walking.play()
              
                } 
            break;

      case 'ArrowLeft':

              if(startofplaceX > 0){

                startofplaceX -= 10; // Mover hacia la izquierda
                walking.play()

                }

        break;

        
      case 'ArrowRight':

              if(startofplaceX < 760){

                startofplaceX += 10; // Mover hacia la derecha
                walking.play()
              
              }
        break;

      default:

        break;

  }
     

    mover(startofplaceX, startofplaceY, globalvar);
    //lt_map.clearRect(0, 0, layer_bottom.width, layer_bottom.height);

    if (globalvar === 1){
        if(startofplaceX === 0){

          changeworld = confirm("¿Estas seguro que quieres comenzar la aventura?")

              if(changeworld){
                
                lt_map.clearRect(0, 0, layer_bottom.width, layer_bottom.height);
                globalvar = 2;
                startofplaceX = 750;
                startofplaceY = 170;
                lb_map.clearRect(0, 0, layer_bottom.width, layer_bottom.height);
                lt_map.clearRect(0, 0, layer_top.width, layer_top.height);
                pallettown.draw();
                natural.play()
                mover(startofplaceX, startofplaceY, globalvar);
                //lb_map.reset();
               // lt_map.reset();
              }
        }


      }

      if (globalvar === 2) {
        
        if(startofplaceX === 760){

            changeworld = confirm("¿Deseas regresar a Pueblo Primavera?")

                if(changeworld){
                  globalvar = 1;
                  startofplaceX = 120;
                  startofplaceY = 270;
                  lb_map.clearRect(0, 0, layer_bottom.width, layer_bottom.height);
                  lt_map.clearRect(0, 0, layer_top.width, layer_top.height);
                  springTown.draw();
                  natural.pause()
                  mover(startofplaceX, startofplaceY, globalvar);
                  //lb_map.reset();
                // lt_map.reset();
                }
            }
      }
    
    


  });
 
</script>
<link rel="stylesheet" href="style.css">