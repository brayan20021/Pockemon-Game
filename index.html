<audio id="intro" src="audio/pockemonaudio.mp3"></audio>
<audio id="walking" src="audio/walking.mp3"></audio>
<audio id="natural" src="audio/natural.mp3"></audio>
<audio id="springtown" src="audio/springtown.mp3"></audio>
<audio id="naturalnight" src="audio/naturalnight.mp3"></audio>
<audio id="pokemon-battle" src="audio/pokemonbattle.mp3"></audio>

<div id="background">
  <canvas id="canvas1"></canvas>
  <canvas id="canvas2"></canvas>
</div>

<div id="background2">
<canvas id="canvas3"></canvas>
</div>

<script>

  // const miAudio = document.getElementById("mi-audio");
  //miAudio.play();


//Audios del juego

var intro = document.getElementById("intro")
intro.play() 



var walking = document.getElementById('walking');
var natural = document.getElementById('natural');
var springtown_audio = document.getElementById('springtown');
var naturalnight = document.getElementById('naturalnight');
var pokemon_battle = document.getElementById("pokemon-battle");

//INTERACCION CON EL PERSONAJE
var globalvar = 1;
var startofplaceX;
var startofplaceY;
var direccion = 1;


  //INICIALIZACION DE CAPAS
  var canvas1 = document.getElementById("canvas1");
  var map = canvas1.getContext("2d");

  var canvas2 = document.getElementById("canvas2");
  var players = canvas2.getContext("2d");

  var canvas3 = document.getElementById("canvas3");
  var framecanvas = canvas3.getContext("2d");

  canvas1.setAttribute("style", "z-index: 2; position:absolute;");
  canvas1.width = 800;
  canvas1.height = 600;

  canvas2.setAttribute("style", "z-index: 10000; position:relative;");
  canvas2.width = 800;
  canvas2.height = 600;

  canvas3.setAttribute("style", "z-index: 2; position:relative;");
  canvas3.width = 400;
  canvas3.height = 600;

  //INICIALIZACION DE LAYER BOTTOM 
  var imagen = new Image();
  imagen.src = "img/pockemon.png";

  imagen.onload = function () {
    map.drawImage(imagen, 180, 10, 450, 180);
  }  

  //INICIALIZACION DE LAYER TOP 
  var font = new FontFace('pokemon', 'url(fonts/PokemonHollow.ttf)');
    font.load().then(function (loadedFont) {
    document.fonts.add(loadedFont);
    
    startofplaceX = 650;
    startofplaceY = 280;

    map.font = '30px pokemon';
    map.fillText('1.- J U E G O    N U E V O', 180, 500);
    map.fillText('2 -  S A L I R', 180, 550);
  }); 

  //DIFINCION DE ELEMENTOS DINAMICOS
  var myImage = new Image();
  myImage.src = "img/player/left2.png";   
  myImage.onload = function () {
                //this.x = startofplaceX;
                //this.y = startofplaceY;
                players.drawImage(myImage, startofplaceX, startofplaceY, 50, 50);                
                players.font = 'bold 20px arial';
                players.fillText(this.name, this.x , this.y);
            }

            

const city = ({name = 'Principal', x = null, y = null, width = null, height = null, routeImage = null}) => ({

name,
x,
y,
width,
height,
routeImage,

          draw () {

                var myImage = new Image();
                myImage.src = routeImage;   
                myImage.onload = function () {

                    map.drawImage(myImage, width, height, 800, 600);

                } 

              }
 
})

const player = ({name = 'player', x = 0, y = 0, width = 130, height = 100, routeImage = null, speed = 5, location = 1}) => ({

name,
x,
y,
width,
height,
location,
speed: 5,
routeImage,
            draw () {
 //var myImage = new Image();
 // myImage.src = routeImage;  
           // myImage.onload = function () {
                //this.x = startofplaceX;
                //this.y = startofplaceY;
                var pasosX = ((x / 2) % 2);
                var pasosY = ((y / 2) % 2);
                
                switch(direccion){

                  case 1:  
                        if(pasosX == 0){
                        myImage.src = "img/player/left1.png";
                      } else {
                        myImage.src = "img/player/left2.png";
                      }

                      break;

                      case 2:  
                        if(pasosY == 0){
                        myImage.src = "img/player/up1.png";
                      } else {
                        myImage.src = "img/player/up2.png";
                      }
                      
                      break;

                      case 3:  
                        if(pasosX == 0){
                        myImage.src = "img/player/right1.png";
                      } else {
                        myImage.src = "img/player/right2.png";
                      }
                      
                      break;

                      case 4:  
                        if(pasosY == 0){
                        myImage.src = "img/player/down1.png";
                      } else {
                        myImage.src = "img/player/down2.png";
                      }
                      
                      break;


                }

                players.clearRect(0, 0, canvas1.width, canvas1.height)
                players.drawImage(myImage, x, y, 50, 50);                
                players.font = 'bold 20px arial';
                players.fillText(this.name, this.x , this.y);
                console.log("COORDENADA X (" + firstplayer.x + ") Y (" + firstplayer.y + ")");
           // } 
          }
})

const nps = ({name = 'hola', x = 0, y = 0,  npsrouteImage = null, speed = 5}) => ({

name,
x,
y,
location,
speed: 5,
npsrouteImage,
            draw () {
                var npsmyImage = new Image();
                npsmyImage.src = npsrouteImage;  
                npsmyImage.onload = function () {
                              //this.x = startofplaceX;
                              //this.y = startofplaceY;
                
                

                map.drawImage(npsmyImage, x, y, 50, 50);                
                map.font = 'bold 20px';
                map.fillText(this.name, 160 , 320);
            } 
          }
})

const pokemones = ({pokemonname = 'hola', x = 0, y = 0,  pokemonrouteImage = null, tipo = null}) => ({

pokemonname,
x,
y,
pokemonrouteImage,
tipo,

            draw () {
            var pokemonmyImage = new Image();
            pokemonmyImage.src = pokemonrouteImage;  
            pokemonmyImage.onload = function () {
                          //this.x = startofplaceX;
                          //this.y = startofplaceY;
                if(tipo === 2){

                  players.clearRect(400, 0, 400, 600)

                } else if(tipo === 1) {

                  players.clearRect(0, 0, 400, 600);
                  //Aqui vamos a limpiar el otro personaje

                }
            
                players.drawImage(pokemonmyImage, x, y, 300, 300);                
                //map.font = 'bold 20px';
                //map.fillText(this.name, 160 , 320);
            } 

            
          }
          
});


const freameleft = ({framename = null, x = null, y = null, width = null, height = null, freamerouteImage = null}) => ({

framename,
x,
y,
width,
height,
freamerouteImage,

          draw () {

                var framemyImage = new Image();
                framemyImage.src = freamerouteImage;   
                framemyImage.onload = function () {
                    framecanvas.drawImage(framemyImage, width, height, 300, 500);
                    //framecanvas.drawImage("img/freame/framepicture.png", 300, 500);
                }
                framecanvas.font = '30px none';
                framecanvas.fillText(this.framename, 10, 550);

              }
 
});

//En este espacio vamos a crear el marco para informacion del jugador
function freame(name, img){
  
framespring = freameleft({

      framename: name,
      width: 0,
      height: 0,
      freamerouteImage: img,

  });

  framespring.draw()

}




const my_house = city({

  name            : 'myHouse',
  with            : 0,
  height          : 0,
  routeImage      : "img/house/myhouse.png"
});

const houseTeacher = city({

  name            : 'teacherHouse',
  with            : 0,
  height          : 0,
  routeImage      : "img/house/house_teacher.png",

});

//En este apartados vamos a crear los mundos
const springTown = city({

  name            : 'SpringTown',
  width           : 0,
  height          : 0,
  routeImage      : "img/puebloprimavera.png"

});

const pallettown = city({

  name            : 'pallettown',
  width           : 0,
  height          : 0,
  routeImage      : "img/pallettown.png"

});

const shadowVille = city({

  name            : 'shadowville',
  with            : 0,
  height          : 0,
  routeImage      : "img/shadowville.png",

});

//vamos a definir el lugar donde los personaje va a pelear
const arena_forest = city({

name            : 'arena1',
with            : 0,
height          : 0,
routeImage      : "img/arenas/arena.png",


});

//Aqui se va a definir los objetos de los jugadores.
var firstplayer;

function mover(x, y, w) {

firstplayer = player({

  name            :    "Carlos",
  x               :     x,
  y               :     y,
  routeImage      :    "img/player.png",
  speed           :    5,
  location        :    w

});
firstplayer.draw();

}


//Aqui se va a definir los nps

var mother;

function mothernps(x, y, w) {

mother = nps({

  name            : "Hoenn",
  x               :  x,
  y               :  y,
  npsrouteImage   : "img/nps/motherleft.png",
  speed           :  5,
  location        :  w

});
mother.draw();

}

var teacher;

function teachernps(x,y){
  
teacher = nps({

  name            : "OAK",
  x               : x,
  y               : y,
  speed           : 5,
  npsrouteImage   : "img/nps/teacherleft1.png"

});
teacher.draw()
  
}

// Aqui estaremos definiendo los pokemones

var charmander;

function charmander_pk(x,y){
  
 charmander = pokemones({

  pokemonname        : "charmander",
  x                  : x,
  y                  : y,
  pokemonrouteImage  : "img/pokemons/optimus.png",
  tipo               : 2

});

charmander.draw()

}

var alastor;

function alastor_pk(x,y){
  
 alastor = pokemones({

  pokemonname        : "alastor",
  x                  : x,
  y                  : y,
  pokemonrouteImage  : "img/pokemons/alastor.png",
  tipo               : 1

});

alastor.draw()

}



//Aqui estan las funciones que nos permitira mostrar el mundo de forma dinamica
//Esta limpia pantalla y carga el mapa

function springTown_views(){

      globalvar = 1;
      startofplaceX = 120;
      startofplaceY = 270;
      map.clearRect(0, 0, canvas1.width, canvas1.height);
      players.clearRect(0, 0, canvas2.width, canvas2.height);
      framecanvas.clearRect(0, 0, canvas3.width, canvas3.height);
      springTown.draw();
      freame("Pueblo Paleta", "img/freame/1.png")
      natural.pause();
      springtown_audio.play()
      mover(startofplaceX, startofplaceY, globalvar);
      
}

function palletTown_views(){

      players.clearRect(0, 0, canvas1.width, canvas1.height);
      globalvar = 2;
      startofplaceX = 750;
      startofplaceY = 170;
      map.clearRect(0, 0, canvas1.width, canvas1.height);
      players.clearRect(0, 0, canvas2.width, canvas2.height);
      framecanvas.clearRect(0, 0, canvas3.width, canvas3.height);
      pallettown.draw();
      freame("Aldea Paleta", "img/freame/2.png")
      springtown_audio.pause()
      naturalnight.pause()
      natural.play()
      mover(startofplaceX, startofplaceY, globalvar);

}

function shadowVille_views(){

      players.clearRect(0, 0, canvas1.width, canvas1.height);
      globalvar = 3;
      startofplaceX = 740;
      startofplaceY = 310;
      map.clearRect(0, 0, canvas1.width, canvas1.height);
      players.clearRect(0, 0, canvas2.width, canvas2.height);
      shadowVille.draw()
      natural.pause()
      springtown_audio.pause()
      naturalnight.play()
      mover(startofplaceX, startofplaceY, globalvar);
      

}

function house1_Views(){

      globalvar = 10;
      map.clearRect(0, 0, canvas1.width, canvas1.height);
      players.clearRect(0, 0, canvas2.width, canvas2.height);
      my_house.draw()
      mothernps(160,320,11)
      mover(startofplaceX, startofplaceY, globalvar);

}

function houseTeacher_views(){
      
      globalvar = 11;
      players.clearRect(0, 0, canvas1.width, canvas1.height);
      players.clearRect(0, 0, canvas2.width, canvas2.height);
      houseTeacher.draw();
      mover(startofplaceX, startofplaceY, globalvar);
      teachernps(15,130)

}

//Esta funcion nos permite visualizar la pelea de los pokemones, y recibira como argumento,
//la arena que es de donde se va a pelear, el pokemonplayer que es el jugador, y el rival
function arenafight(arena,pokemonplayer,rival){
        
        let z = 0
        let f = 300
        moving = true
        globalvar = 21;
        pokemon_battle.play()
        springtown_audio.pause()
        map.clearRect(0, 0, canvas1.width, canvas1.height);
        players.clearRect(0, 0, canvas2.width, canvas2.height);
        //Aqui es donde se dibujara el fondo de la arena, es dinamico.
        arena.draw()
        
//Aqui se estara definiendo el movimiento de los pokemon a la hora de pelear
//FUNCION IMPORTANTE PARA PELEAR LOS DOS POKEMONES DE FORMA DINAMICA
  setInterval(function(){

          rival(450, z)
          pokemonplayer(130, f)

          if(moving){
          z++
            f--
                if(z === 100){moving = false}

          } else {
              z--
                f++
                    if(z <= 0){ moving = true}

                }

        }, 60)           
    } 



//INTERACCION CON MENU
canvas2.addEventListener("click", function(event) {
  var x = event.clientX - canvas2.offsetLeft;
  var y = event.clientY - canvas2.offsetTop;
  

  if (x >= 55 && x <= 489 && y >= 470 && y <= 504) {
    map.clearRect(0, 0, canvas1.width, canvas1.height)

    springTown.draw();
    intro.pause();
    springtown_audio.play()


    mover(650, 280, 1);
  }
});

//Aqui vamos a definir la clase para crear los pokemones
class pokemon {

      constructor(nombre, tipo, nivel, experiencia, hp, ataque, defensa, velocidad, movimientos){

        this.nombre       =   nombre
        this.tipo         =   tipo
        this.nivel        =   nivel
        this.experiencia  =   experiencia
        this.hp           =   hp
        this.ataque       =   ataque
        this.defensa      =   defensa
        this.velocidad    =   velocidad
        this.movimientos  =   movimientos

      }

      atacar(rival){

        function calcular_efectividad(tipo_atacante, tipo_oponente) {
          
          if (tipo_atacante === 'Fuego' && tipo_oponente === 'Hierba') {
            return 2; 
          } else if (tipo_atacante === 'Fuego' && tipo_oponente === 'Agua') {
            return 0.5; 
          } else if (tipo_atacante === 'Agua' && tipo_oponente === 'Fuego') {
            return 2;
          } else if (tipo_atacante === 'Agua' && tipo_oponente === 'Hierba') {
            return 0.5;
          } else if (tipo_atacante === 'Hierba' && tipo_oponente === 'Agua') {
            return 2;
          } else if (tipo_atacante === 'Hierba' && tipo_oponente === 'Fuego') {
            return 0.5;
          } else {
            return 1; 
          }
        }
          
        let efectividad = calcular_efectividad(this.tipo, rival.tipo);
        let damage = Math.floor(((((2 * this.nivel) / 5) + 2) * this.ataque * efectividad) / rival.defensa / 50) + 2;
        rival.hp -= damage;

      }

      subir_nivel(){
      //aqui vamos a definir la logica para subir nivel

      }

      aprender_movimiento(){
      //aqui la logica para aprender movimiento

      }

}

var charmander = new pokemon(
  "Charmander",
   "Fuego",
    5,
    0,
    39,
    52,
    43,
    65,
    ["Ascuas", "Arañazo", "Malicioso", "Gruñido"
]);

var alastor = new pokemon(
  "Alastor",
  "Agua",
    6,
    0, 
    40,
    50,
    41,
    66,
    ["Tornado", "Arañazo", "Malicioso", "Gruñido"

]);



window.addEventListener("keydown", (event) => {
    //CAPTURA DE COORDENADAS
    switch(event.key){
      case 'ArrowUp':
        direccion = 2;

          if(startofplaceY > 0){
            
            startofplaceY -= 10; // Mover hacia arriba
            
            //umbrales
            if (globalvar === 1 && startofplaceX < 210 && startofplaceY > 180) {startofplaceY += 10;}
            
            walking.play()

            }

            break;

      case 'ArrowDown':
          direccion = 4;
              if(startofplaceY < 550){
                
                startofplaceY += 10; // Mover hacia abajo
                walking.play()
              
                } 
            break;

      case 'ArrowLeft':
          direccion = 1;

              if(startofplaceX > 0){

                startofplaceX -= 10; // Mover hacia la izquierda
                walking.play()

                }

        break;

        
      case 'ArrowRight':
          direccion = 3;

              if(startofplaceX < 760){

                startofplaceX += 10; // Mover hacia la derecha
                walking.play()
              
              }
        break;

      default:

        break;

  }
     

     mover(startofplaceX, startofplaceY, globalvar);
    //players.clearRect(0, 0, canvas1.width, canvas1.height);

    if (globalvar === 1){

              if (startofplaceX === 0){

                changeworld = confirm("¿Estas seguro que quieres comenzar la aventura?")
                    if(changeworld){
                      
                      palletTown_views()
                      //map.reset();
                    // players.reset();
                    }
              }

              if (startofplaceX > 430 && startofplaceX < 470 && startofplaceY > 420 && startofplaceY < 450){

                  changeworld = confirm("¿Deseas entrar a casa?")
                    if(changeworld){
                      house1_Views()

                    }
              }

              if (startofplaceX > 250 && startofplaceX < 300 && startofplaceY > 140 && startofplaceY < 190){
                  
                  changeworld = confirm("Presione aceptar para entrar al laboratorio del profesor OAK")
                    if(changeworld){
                      houseTeacher_views()

                    }
              }

              if(startofplaceX === 760){
                  changeworld = confirm("Vas a entrar a la sala de pelea como prueba")
                    if(changeworld){
                      arenafight(arena_forest,alastor_pk,charmander_pk)
                    }
              }
        }

    if (globalvar === 2) {
      
              if (startofplaceX === 760){

                  changeworld = confirm("¿Deseas regresar a Ciudad Paleta?")
                      if(changeworld){

                        springTown_views()

                      }
              }

              if(startofplaceX === 0 && startofplaceY > 90 && startofplaceX < 150){

                  changeworld = confirm("Deseas ir a Villa sombra")
                    if(changeworld){

                       shadowVille_views();

                      }
              }
        }

    if(globalvar === 3){

              if(startofplaceX === 760 && startofplaceY > 290 && startofplaceY < 320){
                  
                  changeworld = confirm("¿Deseas regresar a aldea paleta?")
                    if(changeworld){
                          
                      palletTown_views()

                    }
              }

      }

    if (globalvar === 10){

              if (startofplaceX > 330 && startofplaceX < 410 && startofplaceY > 540){

                changeworld = confirm("¿Estas seguro que deseas salir de casa?")
                  if(changeworld){

                    springTown_views()
                    
                    }
              }
        }

    if (globalvar === 11){

              if (startofplaceY > 520 && startofplaceY < 550 && startofplaceX > 190 && startofplaceX < 240){

                  changeworld = confirm("¿Desea salir del laboratorio?")
                    if(changeworld){

                      springTown_views()

                    }
              }
        }

    
    


  });
 
</script>
<link rel="stylesheet" href="style.css">
<script src="messages.js"></script>